**To test the correct OpenAPI:**
- run as maven goal
- check the target/classes/META-INF/swagger/micronaut-openapi-generation-test-1.0.0.yml
- or open
http://localhost:8080/swagger/micronaut-openapi-generation-test-1.0.0.yml


**Problems:**
1. [x] mapping method javadoc is not considered:
   https://youtrack.jetbrains.com/issue/IDEA-334234
      _source_:
    ```java
      /**
        * getTest1 method
        * @param pv1 some pathvar
        * @return dummy test1 output
      */
          @Get(uri = "/test1/{pv1}", produces = MediaType.TEXT_PLAIN)
          public String test1(String pv1) {
          return "test1";
          }
    ```
      _generated_: no descriptions; summary is autogenerated
    ```yaml
    paths:
      /test1/{pv1}:
        get:
          summary: "GET test1/{pv1}"
          operationId: "test1"
          parameters:
            - name: "pv1"
              in: "path"
              required: true
              schema:
                type: "string"
      responses:
        "200":
          description: "OK"
          content:
            text/plain:
              schema:
                type: "string"
   ```
   _expected_: summary and descriptions for method, parameter and response are taken from javadoc
   ```yaml
   paths:
     /test1/{pv1}:
       get:
         summary: getTest1 method
         description: getTest1 method
         operationId: test1
         parameters:
         - name: pv1
           in: path
           description: some pathvar
           required: true
           schema:
             type: string
         responses:
           "200":
             description: dummy test1 output
             content:
               text/plain:
                 schema:
                   type: string
   ```
2. The existing `@OpenAPIDefinition` attributes are not considered on generating OpenAPI

3. property placeholders in swagger annotations are not resolved, properties are shown as not used
  (same as for spring?)
    https://youtrack.jetbrains.com/issue/IDEA-283036
    https://youtrack.jetbrains.com/issue/IDEA-282795
 
4. [x] single parameter in the POST methods is not processed as request body if the explicit @Body annotation is not provided
   https://youtrack.jetbrains.com/issue/IDEA-334227

    ```java
    @Post
        public boolean post1(List<FirstPojo> pojoList){
            return true;
        }
    ```
    vs

    ```java
    import io.micronaut.http.annotation.Body;

    @Post
    public boolean post1(@Body List<FirstPojo> pojoList) {
      return true;
    }
    ```
5. [x] `@Body#value` should be considered: https://youtrack.jetbrains.com/issue/IDEA-334230
    for the following code
    ```java
    @Post("/test3")
        public String post3(@Body("p1") Integer p1 ){
            return ":"+p1;
        }
    ```
    _generated_:

    ```yaml
    paths:
      /first/test3:
        post:
          summary: "POST first/test3"
          operationId: "post3"
          requestBody:
            content:
              application/json:
                schema:
                  type: "integer"
                  format: "int32"
        required: true   
    ```
    
    _expected_:

   ```yaml
     /first/test3:
       post:
         operationId: post3
         requestBody:
           content:
             application/json:
               schema:
                 type: object
                 properties:
                   p1:
                     type: integer
                     format: int32
           required: true
         
   ```
6. [x] Multiple parameters in post method https://youtrack.jetbrains.com/issue/IDEA-334228
   
   ```java
   @Post("/test4")
       public String post4(String arg1, int arg2, boolean arg3){
   }
   ```
   _expected_:
   ```yaml
     /first/test4:
       post:
         operationId: post4
         requestBody:
           content:
             application/json:
               schema:
                 type: object
                 properties:
                   arg1:
                     type: string
                   arg2:
                     type: integer
                     format: int32
                   arg3:
                     type: boolean
           required: true
   ```
7. [ ] in case of @Nullable annotation for parameters it should be added to schema:
```java
@Get(value = "/test2/{name}/queryvars{?var1,var2}")
    public String test2(@Nullable @PathVariable(name="name", defaultValue = "foo")  String pv1, @Nullable @QueryValue(value = "var1", defaultValue = "bar") String qv1, @Nullable @QueryValue(value = "var2", defaultValue = "false") boolean qv2) {
        return pv1;
    }
```
```yaml
  /vars/test2/{name}/queryvars:
     get:
        operationId: test2
        parameters:
           - name: name
             in: path
             required: true
             schema:
                type: string
                nullable: true
                default: foo
           - name: var1
             in: query
             schema:
                type: string
                nullable: true
                default: bar
           - name: var2
             in: query
             schema:
                type: boolean
                nullable: true
                default: false
        responses:
           "200":
              description: test2 200 response
              content:
                 application/json:
                    schema:
                       type: string
 
```
8. [ ] Impossible to generate draft for the controller class if the @Controller annotation has no #uri
```java
@Controller   // no inlay == no action to generate the OpenAPI draft
public class MyController {

    @Get(uri = "/test1/{pv1}")
    public String test1(String pv1) {
        return "test1";
    }

    @Post(value = "/test2")
    public List<String> test2(@Body String[] mybody) {
        return List.of(mybody);
    }
}   
```
9. [ ] No draft for endpoints inherited from not annotated parent

```java
public interface ParentMappings {

    @Get("/listOfPojos") // inlay is present but w/o action
    List<SecondPojo> list();
}
@Controller("/inherited") // inlay with action, but draft contains no paths
public class ImplementationController implements ParentMappings {
   @Override // no inlay
   public List<SecondPojo> list() {
      return null;
   }
}
```
or
```java
public class BaseMapping {

    @Get("/test1") // inlay is present but w/o action
    public String parentGet(){
        return "from base class";
    }
}

@Controller("/classInheritance") // inlay with action, but draft doesn't contain endpoint from parent
public class ChildMappingController extends BaseMapping {
   @Get("/test2")
   public String childGet(){
      return "from child class";
   }
}
```
10. Swagger: @ApiResponse is not processed
```java
    @ApiResponse(content = @Content(mediaType = "application/json", schema = @Schema(type="string")))
    @ApiResponse(responseCode = "400", description = "YOU ARE WRONG")
    @ApiResponse(responseCode = "404", description = "NOTHING FOUND")
    @Get("/test2")
    public String apiResponseTest(){
        return "";
    }

```
  generated:
```yaml
  /swagger/test2:
    get:
      summary: "GET swagger/test2"
      operationId: "apiResponseTest"
      responses:
        "200":
          description: "OK"
          content:
            '*/*':
              schema:
                type: "string"
```
   expected:

```yaml
        /swagger/test2:
        get:
           operationId: apiResponseTest
           responses:
              "400":
                 description: YOU ARE WRONG
              "404":
                 description: NOTHING FOUND
              "200":
                 description: OK response
                 content:
                    application/json:
                       schema:
                          type: string
```
11. [ ] the default response content mediatype should be application/json, not '*/*'

if no values are provided explicitly, the default mediatype for both request and response should be
`application/json`. Actually the generated response content mediatype is `'*/*'`

```java
// defaults: generated response content type is '*/*', should be application/json
    @Post("/test4")
    public List<String> test4(@Body String[] mybody){
        return List.of(mybody);
    }
```
required:

```yaml
  /test4:
    post:
      operationId: test4
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
```
12. [ ] Swagger: if @Operation is present but no #operationId is specified for it, generated operationId is empty

```java
    @Get(uri="/test1")
    @Operation(summary = "SUPER OPERATION SUMMARY",  // ok
            description = "SUPER OPERATION DESCRIPTION" // ok
    )
    public String noOpIdTest() {
        return "";
    }
```
generated:
```yaml
  /swagger/test1:
    get:
      summary: "SUPER OPERATION SUMMARY"
      description: "SUPER OPERATION DESCRIPTION"
      operationId: ""
```
expected:

```yaml
  /swagger/test1:
    get:
      summary: SUPER OPERATION SUMMARY
      description: SUPER OPERATION DESCRIPTION
      operationId: noOpIdTest

```
13. [ ] Swagger: @Parameter#required, #name are ignored

```java
   // @Parameter#name and #required attributes are ignored; description - ok
    @Get(uri= "/test3/{arg}")
    public String parameterTest(@Parameter(description="NAME PARAMETER DESCRIPTION", name = "MYNAME", required = false) String arg) {
        return arg;
    }
```
generated:
```yaml
  /swagger/test3/{arg}:
    get:
      summary: "GET swagger/test3/{arg}"
      operationId: "parameterTest"
      parameters:
        - name: "arg"
          in: "path"
          required: true
          description: "NAME PARAMETER DESCRIPTION"
          schema:
            type: "string"
```
expected:

```yaml
  /swagger/test3/{arg}:
    get:
      operationId: parameterTest
      parameters:
      - name: MYNAME
        in: path
        description: NAME PARAMETER DESCRIPTION
        required: false
        schema:
          type: string
```
14. [ ] Swagger: @Parameter#hidden attribute should be considered

@Operation#hidden is considered, and the endpoint with hidden == true is not included to draft. However the hidden parameters are still shown

```java
// parameter is not hidden but should be
    @Get(uri= "/test4/{arg}")
    public String hiddenParameter(@Parameter(hidden = true) String arg) {
        return arg;
    }
```
TODO: validation tags, Micronaut @OpenAPI annotations

YouTrack template link: https://youtrack.jetbrains.com/newIssue?project=IDEA&summary=Micronaut%3A+Generate+OpenAPI+Draft%3A&description=233.9470%0A%0A%0Aexample+code%3A%0A%0A%60%60%60%0A%60%60%60%0Agenerated+result%3A%0A%0A%60%60%60%0A%60%60%60%0A%0Aexpected+result%3A%0A%0A%60%60%60%0A%60%60%60%0A&c=relates+to+IDEA-330735&c=add+Board+Platform+UI&c=Subsystem+Frameworks.+Micronaut&c=Assignee+zhanna.gorelova&c=Tester+irina

## 
- [Micronaut OpenAPI Support documentation](https://micronaut-projects.github.io/micronaut-openapi/latest/guide/index.html)

- [https://www.openapis.org](https://www.openapis.org)

## Feature micronaut-aot documentation

- [Micronaut AOT documentation](https://micronaut-projects.github.io/micronaut-aot/latest/guide/)



## Feature serialization-jackson documentation

- [Micronaut Serialization Jackson Core documentation](https://micronaut-projects.github.io/micronaut-serialization/latest/guide/)


